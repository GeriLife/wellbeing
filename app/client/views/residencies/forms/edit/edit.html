<template name="editResidencyModal">
  <div class="modal fade">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          {{> flashMessages}}
          <h4 class="modal-title">
            {{_ "editResidencyModal-header" }}
          </h4>
        </div>
        <!-- / .modal-header -->
        {{# if Template.subscriptionsReady }}
        <div class="modal-body">
          <!-- check if residency exists - editing -->
          {{# if residency }}
          {{#unless addNewResidencyClicked}}
          {{#unless residency.moveOut}}
          <p>
            {{_ "residencies.note1"}}
            <a
              class="add-new-residency-link"
              >{{_ "residencies.clickHere"}}</a
            >
            {{_ "residencies.note2"}}
          </p>
          {{/unless}}
          {{#autoForm id="editResidencyForm" type="update" collection="Residencies" doc=residency }}

          <label for="residentId">
            {{_ "residencies.residentId.label" }}
          </label>
          {{> afFieldInput name="residentId" disabled="true" options=residentIdOptions }}

          <label for="homeId">
            {{_ "residencies.homeId.label" }}
          </label>
          {{> afFieldInput name="homeId" disabled="true" options=homeSelectOptionsWithGroups }}

          <label for="moveIn">
            {{_ "residencies.moveIn.label" }}
          </label>
          {{> afFieldInput name="moveIn" class="dateField" buttonClasses="fa fa-calendar" }}

          <label for="moveOut">
            {{_ "residencies.moveOut.label" }}
          </label>
          {{> afFieldInput name="moveOut" class="dateField" buttonClasses="fa fa-calendar" }}

          <br />

          <button type="submit" class="btn btn-success">
            {{_ "editResidencyForm-save" }}
          </button>
          <button
            type="button"
            class="btn btn-danger"
            data-dismiss="modal"
          >
            {{_ "editResidencyForm-cancel" }}
          </button>

          {{/ autoForm }}

          {{else}}

          {{> addResidencyForExistingResidentForm data=newResidency dismiss=dismiss }}
          {{/unless}}
          {{ else }}
          <!-- add new residency using resident and home IDs -->
          <!-- TODO: remove this option after migrating all data -->
          {{> addResidencyForm residentId=residentId homeId=homeId }}
          {{/ if }}
        </div>
        <!-- / .modal-body -->
        {{ else }}
        {{> spinner }}
        {{/ if }}
        <!-- /if Template.subscriptionsReady -->
      </div>
      <!-- / .modal-content -->
    </div>
    <!-- / .modal-dialogue -->
  </div>
  <!-- / .modal fade -->
</template>
